{{ $data := .Site.GetPage "page" "general.md" }}

{{ $paginator := .Paginate (where .Data.Pages.ByDate.Reverse ".Type" "!=" "page") $data.Params.pagination }}

{{ if eq .Section "noticias "}}
    {{ $paginator = .Paginate (where .Data.Pages.ByDate.Reverse ".Section" "noticias" ) $data.Params.pagination }}
{{ end }}

{{ if (eq $paginator.PageNumber 1) }}

{{ range first 1 $paginator.Pages }}

<!-- range first 1 (where .Data.Pages "Section" "noticias") -->
<!-- Featured Post -->
<article class="post featured">
    <header class="major">
        <span class="date">{{ .Date.Format "02-01-2006" }} </span>
        <h2><a href="{{.URL}}">{{ .Title }}</a></h2>
        <p>{{.Description}}</p>
    </header>
    {{ if .Params.images }}
        {{ $mediaPage := .Site.GetPage "page" "media/index.md"}}
        {{ range first 1 .Params.images }}	
            {{ $image := $mediaPage.Resources.GetMatch (replace .image "/media/" "") }}            
            {{ if and (gt $image.Width $image.Height) (gt $image.Width 600) }}
                {{ $.Scratch.Set "resized" ($image.Fill "896x436 q75") }}
            {{ else if gt $image.Width 400 }}
                {{ $.Scratch.Set "resized" ($image.Resize "400x q75") }}
            {{ else }}
                {{ $.Scratch.Set "resized" $image }}
            {{ end }}
            <a href="{{$image.RelPermalink}}" class="image main"><img src="{{ ($.Scratch.Get "resized").RelPermalink}}" alt="" /></a>
        {{ end }}
    {{ end }}
    <ul class="actions special">
        <li><a href="{{.URL}}" class="button large">Ver más</a></li>
    </ul>
</article>

{{ end }}

{{ end }}

<!-- Posts -->
    <section class="posts">
        <!-- range $index, $value := where .Data.Pages "Section" "noticias" -->
        
        {{ range $index, $value := $paginator.Pages }}
            {{ if or (and (gt $index 0) (eq $paginator.PageNumber 1)) (gt $paginator.PageNumber 1) }}
                
            <article>
                <header>
                    <span class="date">{{ .Date.Format "02-01-2006" }}</span>
                    <h2><a href="{{.URL}}">{{.Title}}</a></h2>
                </header>
                {{ if .Params.images }}
                {{ $mediaPage := .Site.GetPage "page" "media/index.md"}}
                    {{ range first 1 .Params.images }}	
                        {{ $image := $mediaPage.Resources.GetMatch (replace .image "/media/" "") }}            
                        {{ if and (gt $image.Width $image.Height) (gt $image.Width 600) }}
                            {{ $.Scratch.Set "resized" ($image.Fill "896x436 q75") }}
                        {{ else if gt $image.Width 400 }}
                            {{ $.Scratch.Set "resized" ($image.Fill "597x364 q75") }}
                        {{ else }}
                            {{ $.Scratch.Set "resized" $image }}
                        {{ end }}
                        <span class="image main"></a><img src="{{ ($.Scratch.Get "resized").RelPermalink}}" alt="" /></span>
                    {{ end }}
                {{ else }}
                    <span class="image main"><img src="/assets/img/sambo_597.png" alt="" /></span>
                {{ end }}

                <p>{{ .Description }}</p>
                <ul class="actions special">
                    <li><a href="{{.URL}}" class="button">Ver más</a></li>
                </ul>
            </article>	
            {{ end }}
        {{ end }}
        
    </section>
